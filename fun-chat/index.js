(()=>{"use strict";var e={11:(e,n,t)=>{t.d(n,{A:()=>c});var i=t(601),s=t.n(i),a=t(314),o=t.n(a),r=t(768),d=t(699),l=o()(s());l.push([e.id,"@import url(https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600&display=swap);"]),l.i(r.A),l.i(d.A),l.push([e.id,'html{line-height:1.15;-webkit-text-size-adjust:100%}html body{margin:0;box-sizing:border-box;font-family:"Poppins",sans-serif}html *{margin:0;box-sizing:border-box}html a{background-color:rgba(0,0,0,0)}html button,html input,html optgroup,html select,html textarea{font-family:inherit;font-size:100%;line-height:1.15;margin:0}.container{margin:0 auto;max-width:1440px;min-height:100vh;max-height:max-content;display:flex;flex-direction:column;justify-content:center;align-items:center;background:#282727}',""]);const c=l},768:(e,n,t)=>{t.d(n,{A:()=>r});var i=t(601),s=t.n(i),a=t(314),o=t.n(a)()(s());o.push([e.id,".login__form {\n    margin-inline: 20px;\n    padding: 40px 16px;\n    max-width: 360px;\n    background: hsla(0, 0%, 100%, 0.2);\n    border: 2px solid hsla(0, 0%, 100%, 0.7);\n    color: hsl(0, 0%, 100%);\n    border-radius: 16px;\n    backdrop-filter: blur(16px);\n\n    .login__title {\n        margin: 20px 0;\n        text-align: center;\n        font-size: 40px;\n    }\n}\n\n.login__body {\n    display: grid;\n    row-gap: 20px;\n    margin-bottom: 16px;\n\n    .login__body_wrap {\n        display: grid;\n        padding-inline: 20px;\n        grid-template-columns: 1fr max-content;\n        column-gap: 12px;\n        align-items: center;\n        border: 2px solid hsla(0, 0%, 100%, 0.7);\n        border-radius: 64px;\n    }\n\n    .login__body_input {\n        outline: none;\n        width: 100%;\n        background: none;\n        border: none;\n        color: hsl(0, 0%, 100%);\n        padding-block: 16px;\n\n        &::placeholder {\n            color: hsl(0, 0%, 100%);\n        }\n    }\n}\n\n.login__button {\n    width: 100%;\n    padding: 16px;\n    margin-bottom: 16px;\n    background-color: hsl(0, 0%, 100%);\n    border-radius: 64px;\n    color: hsl(0, 0%, 0%);\n    font-weight: 500;\n    cursor: pointer;\n    border: none;\n    outline: none;\n}\n\n.modal-error-wrap {\n    position: absolute;\n    top: 0;\n    left: 0;\n    width: 100%;\n    height: 100%;\n    display: flex;\n    justify-content: center;\n    align-items: center;\n    background: rgba(0, 0, 0, 0.6);\n}\n.modal-error-content {\n    padding: 16px;\n    width: 260px;\n    text-transform: capitalize;\n    border: 2px solid hsla(0, 0%, 100%, 0.7);\n    border-radius: 6px;\n    background: #282727;\n    text-transform: uppercase;\n    text-align: center;\n    color: #fff;\n}",""]);const r=o},699:(e,n,t)=>{t.d(n,{A:()=>r});var i=t(601),s=t.n(i),a=t(314),o=t.n(a)()(s());o.push([e.id,".main-wrap {\n    width: 90%;\n    height: 560px;\n    display: flex;\n    flex-direction: column;\n    border-radius: 5px;\n    box-shadow: 0 0 10px 0 #444242;\n    color: hsl(0, 0%, 100%);\n\n    .main-header,\n    .main-footer {\n        padding: 0 16px;\n        height: 55px;\n        display: flex;\n        justify-content: space-between;\n        align-items: center;\n        flex-shrink: 0;\n    }\n    .main-header {\n        width: 100%;\n        height: 55px;\n\n        .main-header_user {\n            font-size: 24px;\n        }\n        .main-header_control {\n            display: flex;\n            gap: 25px;\n            font-size: 16px;\n\n            h1 {\n                margin-right: 50px;\n                font-size: 25px;\n            }\n            button {\n                border-radius: 6px;\n                border: none;\n                background: hsl(0, 0%, 100%);\n                cursor: pointer;\n\n                &:active {\n                    background: #5C5F6F;\n                }\n            }\n        }\n    }\n    .main-chat {\n        display: flex;\n        height: 450px;\n        overflow-y: auto;\n        border-top: solid 1px #5C5F6F;\n        border-bottom: solid 1px #5C5F6F;\n\n        &_list-wrap {\n            list-style: none;\n        }\n    }\n\n    .main-chat_field {\n        display: flex;\n        width: 75%;\n        flex-direction: column;\n        overflow-y: hidden;\n\n        .main-chat_field-chatUser {\n            display: flex;\n            justify-content: space-around;\n            padding: 10px;\n            border-bottom: solid 1px #5C5F6F;\n\n            p.offline {\n                color: hsl(0, 2%, 64%);\n            }\n        }\n\n        .main-chat_field-messagesWrap {\n            flex-grow: 1;\n            display: flex;\n            flex-direction: column;\n            justify-content: flex-start;\n            position: relative;\n            overflow-y: auto;\n            scrollbar-width: thin;\n            scrollbar-color: #282727 hsl(0, 0%, 35%);\n\n            & > :first-child {\n                margin-top: auto\n            }\n\n            &::-webkit-scrollbar {\n                width: 12px;\n            }\n            &::-webkit-scrollbar-track {\n                background: hsl(0, 0%, 35%);\n            }\n            &::-webkit-scrollbar-thumb {\n                background-color: #282727;\n                border-radius: 20px;\n                border: 3px solid hsl(0, 0%, 35%);\n            }\n\n            .main-chat_field-startMessage {\n                position: absolute;\n                top: 50%;\n                width: 100%;\n                text-align: center;\n            }\n        }\n\n        .main-chat_field-entryWrap {\n            display: flex;\n            justify-content: space-between;\n            gap: 16px;\n            padding: 5px 16px;\n            border-top: solid 1px #5C5F6F;\n            transform: translateY(0);\n            transition: transform .5s;\n\n            &.hide {\n                transform: translateY(52px);\n            }\n        }\n        .main-chat_field-inputWrap {\n            flex-grow: 1;\n            padding-inline: 20px;\n            border: 2px solid hsla(0, 0%, 100%, 0.2);\n            border-radius: 6px;\n        }\n        .main-chat_field-entryBtn {\n            padding: 0 15px;\n            border: none;\n            border-radius: 5px;\n            cursor: pointer;\n\n            &:active {\n                background: #5C5F6F;\n            }\n        }\n    }\n\n    .main-chat_list-wrap {\n        width: 25%;\n        border-right: solid 1px #5C5F6F;\n    }\n    .main-chat_find-wrap {\n        margin: 6px 7px 30px;\n        padding-inline: 20px;\n        width: 95%;\n        border: 2px solid hsla(0, 0%, 100%, 0.2);\n        border-radius: 6px;\n    }\n    .main-chat_field-entryInput,\n    .main-chat_find-Input {\n        outline: none;\n        width: 100%;\n        background: none;\n        border: none;\n        color: hsl(0, 0%, 100%);\n        padding-block: 10px;\n    }\n    .main-chat_list {\n        padding: 0;\n        list-style: none;\n    }\n    .main-chat_list-item {\n        padding: 12px 16px;\n        display: flex;\n        justify-content: space-between;\n        border-bottom: solid 1px #5C5F6F;\n        cursor: pointer;\n\n        &.offline {\n            color: hsl(0, 2%, 64%);\n        }\n        &.hide {\n            display: none;\n        }\n\n        .newMessages-count {\n            background: hsl(0, 0%, 35%);\n            border-radius: 25px;\n            padding: 2px 5px;\n        }\n    }\n}\n\n/* ------- separate line -------- */\n\n.separate-line {\n    position: relative;\n    text-align: center;\n    height: 22px;\n\n    &::before,\n    &::after {\n        content: '';\n        display: block;\n        position: absolute;\n        top: 10px;\n        width: 40%;\n        height: 2px;\n        background: #fff;\n    }\n    &::before {\n        left: 16px;\n    }\n    &::after {\n        right: 16px;\n    }\n}\n\n/* ------- message -------- */\n\n.message-item {\n    margin: 10px;\n    width: 55%;\n    padding: 5px;\n    position: relative;\n    border-radius: 10px;\n\n    &.right {\n        left: 43%;\n        border-top-right-radius: 0;\n        background: #83F0FF;\n        color: #000;\n        cursor: pointer;\n    }\n    &.left {\n        border-top-left-radius: 0;\n        background: hsl(0, 0%, 35%);\n    }\n    .message-item__head {\n        padding: 5px;\n        display: flex;\n        justify-content: space-around;\n        border-bottom: solid 1px #5C5F6F;\n    }\n    .message-item__body {\n        padding: 10px;\n    }\n    .message-item__footer {\n        display: flex;\n        justify-content: end;\n        gap: 25%;\n    }\n}\n\n.message-menu {\n    display: flex;\n    flex-direction: column;\n    gap: 5px;\n    list-style: none;\n    padding: 10px;\n    position: absolute;\n    background: hsl(0, 0%, 35%);\n    border-radius: 5px;\n    cursor: pointer;\n}\n\n@media (max-width: 769px) {\n    .main-wrap {\n        width: 96%;\n        height: 100vh;\n\n        .main-chat_find-wrap {\n            width: 92%;\n        }\n    }\n\n    .message-item {\n        width: 75%;\n        \n        &.right {\n            left: 21%;\n        }\n    }\n}\n\n@media (max-width: 500px) {\n    .main-wrap {\n        width: 98%;\n        height: 100vh;\n\n        .main-chat {\n            flex-grow: 1;\n        }\n        .main-header {\n            & .main-header_control > h1 {\n                margin-right: 10px;\n            }\n        }\n        .main-chat_find-wrap {\n            width: 92%;\n        }\n        .main-footer {\n            flex-wrap: wrap;\n            justify-content: center;\n            gap: 15px;\n        }\n    }\n}",""]);const r=o},314:e=>{e.exports=function(e){var n=[];return n.toString=function(){return this.map((function(n){var t="",i=void 0!==n[5];return n[4]&&(t+="@supports (".concat(n[4],") {")),n[2]&&(t+="@media ".concat(n[2]," {")),i&&(t+="@layer".concat(n[5].length>0?" ".concat(n[5]):""," {")),t+=e(n),i&&(t+="}"),n[2]&&(t+="}"),n[4]&&(t+="}"),t})).join("")},n.i=function(e,t,i,s,a){"string"==typeof e&&(e=[[null,e,void 0]]);var o={};if(i)for(var r=0;r<this.length;r++){var d=this[r][0];null!=d&&(o[d]=!0)}for(var l=0;l<e.length;l++){var c=[].concat(e[l]);i&&o[c[0]]||(void 0!==a&&(void 0===c[5]||(c[1]="@layer".concat(c[5].length>0?" ".concat(c[5]):""," {").concat(c[1],"}")),c[5]=a),t&&(c[2]?(c[1]="@media ".concat(c[2]," {").concat(c[1],"}"),c[2]=t):c[2]=t),s&&(c[4]?(c[1]="@supports (".concat(c[4],") {").concat(c[1],"}"),c[4]=s):c[4]="".concat(s)),n.push(c))}},n}},601:e=>{e.exports=function(e){return e[1]}},72:e=>{var n=[];function t(e){for(var t=-1,i=0;i<n.length;i++)if(n[i].identifier===e){t=i;break}return t}function i(e,i){for(var a={},o=[],r=0;r<e.length;r++){var d=e[r],l=i.base?d[0]+i.base:d[0],c=a[l]||0,h="".concat(l," ").concat(c);a[l]=c+1;var p=t(h),u={css:d[1],media:d[2],sourceMap:d[3],supports:d[4],layer:d[5]};if(-1!==p)n[p].references++,n[p].updater(u);else{var m=s(u,i);i.byIndex=r,n.splice(r,0,{identifier:h,updater:m,references:1})}o.push(h)}return o}function s(e,n){var t=n.domAPI(n);return t.update(e),function(n){if(n){if(n.css===e.css&&n.media===e.media&&n.sourceMap===e.sourceMap&&n.supports===e.supports&&n.layer===e.layer)return;t.update(e=n)}else t.remove()}}e.exports=function(e,s){var a=i(e=e||[],s=s||{});return function(e){e=e||[];for(var o=0;o<a.length;o++){var r=t(a[o]);n[r].references--}for(var d=i(e,s),l=0;l<a.length;l++){var c=t(a[l]);0===n[c].references&&(n[c].updater(),n.splice(c,1))}a=d}}},659:e=>{var n={};e.exports=function(e,t){var i=function(e){if(void 0===n[e]){var t=document.querySelector(e);if(window.HTMLIFrameElement&&t instanceof window.HTMLIFrameElement)try{t=t.contentDocument.head}catch(e){t=null}n[e]=t}return n[e]}(e);if(!i)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");i.appendChild(t)}},540:e=>{e.exports=function(e){var n=document.createElement("style");return e.setAttributes(n,e.attributes),e.insert(n,e.options),n}},56:(e,n,t)=>{e.exports=function(e){var n=t.nc;n&&e.setAttribute("nonce",n)}},825:e=>{e.exports=function(e){if("undefined"==typeof document)return{update:function(){},remove:function(){}};var n=e.insertStyleElement(e);return{update:function(t){!function(e,n,t){var i="";t.supports&&(i+="@supports (".concat(t.supports,") {")),t.media&&(i+="@media ".concat(t.media," {"));var s=void 0!==t.layer;s&&(i+="@layer".concat(t.layer.length>0?" ".concat(t.layer):""," {")),i+=t.css,s&&(i+="}"),t.media&&(i+="}"),t.supports&&(i+="}");var a=t.sourceMap;a&&"undefined"!=typeof btoa&&(i+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(a))))," */")),n.styleTagTransform(i,e,n.options)}(n,e,t)},remove:function(){!function(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e)}(n)}}}},113:e=>{e.exports=function(e,n){if(n.styleSheet)n.styleSheet.cssText=e;else{for(;n.firstChild;)n.removeChild(n.firstChild);n.appendChild(document.createTextNode(e))}}}},n={};function t(i){var s=n[i];if(void 0!==s)return s.exports;var a=n[i]={id:i,exports:{}};return e[i](a,a.exports,t),a.exports}t.n=e=>{var n=e&&e.__esModule?()=>e.default:()=>e;return t.d(n,{a:n}),n},t.d=(e,n)=>{for(var i in n)t.o(n,i)&&!t.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:n[i]})},t.o=(e,n)=>Object.prototype.hasOwnProperty.call(e,n),t.nc=void 0,(()=>{class e{constructor(e="ws://127.0.0.1:4000"){this.websocketUrl=e,this.connection=new WebSocket(e)}closeListener(e){this.connection.onclose=n=>{if(console.dir(n),!n.wasClean){const n=e("Disconnection server. Try restore the connection",!1);for(let e=0;e<=5;e+=1){let e=!1;if(setTimeout((()=>{this.connection=new WebSocket(this.websocketUrl),this.connection.onopen=()=>{console.log("connect"),e=!0,n.remove()}}),1e3),e)break}}}}userOperation(e,n,t){const i={id:e.includes("IN")?`login_${n}`:`logout_${n}`,type:e,payload:{user:{login:n,password:t}}},s=JSON.stringify(i);this.connection.send(s),this.connection.onerror=e=>{console.log(e)}}getAllUsers(){const e="USER_ACTIVE",n="USER_INACTIVE";this.connection.send(JSON.stringify({id:`get${e.slice(4)}`,type:e,payload:null})),this.connection.send(JSON.stringify({id:`get${n.slice(4)}`,type:n,payload:null}))}getMessageHistory(e){const n={id:"getMessageHist",type:"MSG_FROM_USER",payload:{user:{login:e}}};this.connection.send(JSON.stringify(n))}sendMessage(e,n){const t={id:"sendingMessage",type:"MSG_SEND",payload:{message:{to:e,text:n}}};this.connection.send(JSON.stringify(t))}readStatusChange(e){const n={id:"readStatusAdd",type:"MSG_READ",payload:{message:{id:e}}};this.connection.send(JSON.stringify(n))}deleteMessage(e){const n={id:"deleteMsg",type:"MSG_DELETE",payload:{message:{id:e}}};this.connection.send(JSON.stringify(n))}}const n=(e,n,t=void 0,i=void 0,s=void 0)=>{const a=document.createElement(`${e}`);return a.className=`${n}`,t&&(a.innerText=t),s&&s.forEach((e=>{Object.keys(e).forEach((n=>{a.setAttribute(n,e[n])}))})),i&&i.append(a),a},i=()=>{const e=sessionStorage.getItem("user");if(e){const n=JSON.parse(e),{login:t,password:i}=n,s=(e=>{let n="";const t=e.slice(3);for(let e=0;e<t.length;e+=3)n+=t[e+2];return n})(i);return[t,s]}return e},s=()=>{sessionStorage.removeItem("user")};class a{constructor(e,n=1){this.valueInputs=e,this.amountBtn=n}buildForm(e){const t=n("form","login__form",void 0,void 0,[{action:""}]);return n("h2","login__title","Login",t),t.addEventListener("submit",(n=>{n.preventDefault();const[s,a]=t.querySelectorAll("input"),o=i();if(o){const[n,t]=o;e("USER_LOGIN",n,t)}o||((e=>{const n=(e=>{let n="abc";for(let t=0;t<e.length;t+=1)n+=`${"abcdefghijklmnopqrstuvwxyz"[t%26]}${t%2?4:2}${e[t]}`;return n})(e.password),t={login:e.login,password:n,isLogined:e.isLogined};sessionStorage.setItem("user",JSON.stringify(t))})({login:s.value,password:a.value,isLogined:!0}),e("USER_LOGIN",s.value,a.value))})),t}buildInputs(){const e=n("div","login__body"),t=document.createDocumentFragment();return this.valueInputs.forEach(((e,i)=>{const s=n("div","login__body_wrap");n("input","login__body_input",void 0,s,[{type:e},{placeholder:0===i?"First Name":"Password"},{pattern:""+(0===i?"^[A-ZА-Я][a-zа-я\\-]{2,}":"^[A-Za-z0-9]{3,}")},{title:0===i?"The first letter must be capitalized. Min length: 3":"Min length: 4"},{required:""}]),t.append(s)})),e.appendChild(t),e}buildButton(){const e=document.createDocumentFragment();for(let t=1;t<=this.amountBtn;t+=1)if(1===t){const t=n("button","login__button","Login",void 0,[{type:"submit"}]);e.appendChild(t)}else{const t=n("button","login__button","Info",void 0);e.appendChild(t)}return e}render(e){const n=this.buildForm(e),t=this.buildInputs(),i=this.buildButton();return n.append(t),n.append(i),n}}class o{constructor(e){this.loginForm=new a(["text","password"],2),this.LoginRequest=e}makeErrorModal(e,t=!0){const i=n("div","modal-error-wrap"),s=n("div","modal-error-content",void 0,i);return n("p","modal-error-text",e,s),t&&(i.onclick=()=>i.remove()),document.body.append(i),i}render(e){e.append(this.loginForm.render(this.LoginRequest))}}const r=(e,t)=>{const i=new Date(e.datetime),s=`${i.getDate()}`.padStart(2,"0"),a=`${i.getMonth()+1}`.padStart(2,"0"),o=`${i.getHours()}`.padStart(2,"0"),r=`${i.getMinutes()}`.padStart(2,"0"),d=`${s}.${a}.${i.getFullYear()} ${o}:${r}`,l=e.status.isDelivered?"delivered":"send",c=n("div","message-item "+(e.from===t?"left":"right"));c.id=`message-${e.id}`;const h=n("div","message-item__head");n("p","message-item__head_userName",`${e.from===t?e.from:"you"}`,h),n("p","message-item__head_data",`${d}`,h);const p=n("div","message-item__body");n("p","main-chat_field-messageItemText",`${e.text}`,p);const u=n("div","message-item__footer");return c.append(h,p),e.from!==t&&(n("p","message-item__footerEdited","",u),n("p","message-item__footerStatus",`${e.status.isReaded?"readed":l}`,u),c.append(u)),c};class d{constructor(){this.container=n("div","main-chat_field")}makeCurrentUserField(e,t){const i="main-chat_field-chatUser"===this.container.firstElementChild.className;if(!i){const i=n("div","main-chat_field-chatUser");return n("p",`main-chat_field-userName ${t}`,e,i),n("p",`main-chat_field-userStat ${t}`,t,i),void this.container.prepend(i)}if(i){const n=this.container.firstElementChild,i=null==n?void 0:n.firstElementChild,s=null==n?void 0:n.lastElementChild;i.innerText!==e&&(i.innerText=e),s.innerText!==t&&(s.innerText=t)}}makeMessagesField(){const e=n("div","main-chat_field-messagesWrap");n("div","main-chat_field-startMessage","Select a user for communication",e),this.container.append(e),this.messagesField=e}addOldMessages(e){var n,t,i;if(e.length<1)(null===(n=this.messagesField)||void 0===n?void 0:n.firstChild).innerText="Message history is empty";else{null===(t=this.messagesField)||void 0===t||t.replaceChildren();const n=document.createDocumentFragment(),s=this.container.dataset.name;let a=!0;e.forEach((e=>{e.from===s&&!e.status.isReaded&&a&&(n.append(this.addRemoveSeparateLine("add")),a=!1);const t=r(e,s);n.append(t)})),null===(i=this.messagesField)||void 0===i||i.append(n)}}addRemoveSeparateLine(e){var t;const i=n("div","separate-line","New messages");return i.id="separate-line","add"===e?i:("remove"===e&&(null===(t=this.messagesField)||void 0===t||t.removeChild(i)),null)}addNewMessage(e,n){var t,i,s;const a=document.getElementById("separate-line"),o=r(e,n);(null===(t=this.messagesField)||void 0===t?void 0:t.contains(a))||e.from!==n?null===(s=this.messagesField)||void 0===s||s.append(o):null===(i=this.messagesField)||void 0===i||i.append(this.addRemoveSeparateLine("add"),o)}makeEnteringBlock(){const e=n("form","main-chat_field-entryWrap hide"),t=n("div","main-chat_field-inputWrap");n("input","main-chat_field-entryInput",void 0,t,[{type:"text"},{placeholder:"Message.."}]);const i=n("button","main-chat_field-entryBtn","Send",void 0,[{type:"submit"}]);e.append(t,i),this.container.append(e),this.chatingForm=e}render(){return this.container.children.length<1&&(this.makeMessagesField(),this.makeEnteringBlock()),this.container}}class l{makeLinkToGH(){return n("a","gh-link","My Github",void 0,[{href:"https://github.com/AleksPaty"},{target:"_blank"}])}makeAboutElem(){return n("p","about","Thank you for your attention. 2024 ©")}makeSchoolLog(){return n("p","re-school","RSSchool")}render(){const e=n("div","main-footer");return e.append(this.makeLinkToGH(),this.makeAboutElem(),this.makeSchoolLog()),e}}class c{makeUserNameElem(e){return n("div","main-header_user",`User: ${e}`)}makeBtnsElem(e,t,i){const a=n("div","main-header_control"),o=n("button","main-header_logout","LogOut");return o.onclick=()=>{s(),i("USER_LOGOUT",e,t)},a.append(n("h1","main-header_title","Fun chat"),n("button","main-header_info","Info"),o),a}render(e,t){const i=n("div","main-header");return i.append(this.makeUserNameElem(e.login),this.makeBtnsElem(e.login,e.password,t)),i}}class h{constructor(){this.listContainer=n("div","main-chat_list-wrap"),this.userList=n("ul","main-chat_list")}addUsers(e,t,i){const s=this.userList;t.length&&t.forEach(((t,a)=>{if(e!==t.login&&(i&&i(t.login),!(null==s?void 0:s.children[a])||(null==s?void 0:s.children[a].innerHTML)!==t.login)){const e=t.isLogined?"online":"offline",i=n("li","main-chat_list-item",`${t.login}`,void 0,[{name:`${t.login}`}]);i.classList.add(e),this.userList.append(i)}}))}changeStatus(e,n){const t=this.userList.children.namedItem(e);t?t&&n?(null==t||t.classList.remove("offline"),null==t||t.classList.add("online"),t&&(this.userList.prepend(t.cloneNode(!0)),null==t||t.remove())):(null==t||t.classList.remove("online"),null==t||t.classList.add("offline")):this.addUsers("other",[{login:e,isLogined:n}])}showUnreadMessageCount(e,t){let i=null,s=0;t.forEach((n=>{n.from!==e&&(i||(i=this.userList.children.namedItem(n.from)),n.status.isReaded||(s+=1))})),s>0&&n("div","newMessages-count",`${s}`,i)}removeUnreadMessageCount(e){var n;null===(n=this.userList.children.namedItem(e).lastElementChild)||void 0===n||n.remove()}makeFindInput(){const e=n("div","main-chat_find-wrap");return n("input","main-chat_find-Input",void 0,e,[{type:"text"},{placeholder:"Search.."}]).oninput=e=>{const n=e.target,t=[...this.userList.children];n.value.length>0?t.forEach((e=>{const t=e.innerText.toLowerCase();t.includes(n.value.toLowerCase())||e.classList.add("hide"),t.includes(n.value.toLowerCase())&&e.classList.remove("hide")})):t.forEach((e=>e.classList.remove("hide")))},e}render(){return this.listContainer.children.length<1&&this.listContainer.append(this.makeFindInput(),this.userList),this.listContainer}}class p{constructor(){this.userList=new h,this.userChat=new d,this.headerBlock=new c,this.footerBlock=new l,this.user={login:"",password:"",isLogined:!1}}makeWrap(){return n("div","main-wrap")}chooseUserHandle(e,n){var t;const i=e.target;if("LI"===i.tagName){const e=i.getAttribute("name"),s=i.className.split(" ").at(-1);this.userChat.makeCurrentUserField(e,s),null===(t=this.userChat.chatingForm)||void 0===t||t.classList.remove("hide"),this.userChat.container.dataset.name=e,n(e)}}sendMessageHandle(e,n){var t;e.preventDefault();const i=e.target,s=null===(t=i.firstElementChild)||void 0===t?void 0:t.lastChild;n(i.parentElement.dataset.name,s.value),s.value=""}changeReadStatusHandle(e,n){const t=e.target;document.getElementById("separate-line")&&("scroll"===e.type&&Math.floor(t.scrollHeight-t.scrollTop)-t.clientHeight<2&&this.changeReadStatus(t,n),"click"===e.type&&0===t.scrollTop&&this.changeReadStatus(t,n))}changeReadStatus(e,n){var t;const i=[...e.children];if(i.length<2)return;for(let e=i.length-1;e>=0;e-=1){if(i[e].classList.contains("right"))return;const t=i[e].id;if(t.includes("message")&&n(t.slice(8)),!t.includes("message")){i[e].remove();break}}const s=null===(t=e.parentElement)||void 0===t?void 0:t.dataset.name;this.userList.removeUnreadMessageCount(s)}makeChatBlock(){const e=n("div","main-chat");return e.append(this.userList.render(),this.userChat.render()),e}chatClickHandle(e,t,i){const s=e.currentTarget;this.changeReadStatusHandle(e,t);const a=s.querySelector(".message-menu");a?a.remove():((e,t)=>{const i=e.currentTarget,s=e.target.closest(".message-item");if(!s||s.classList.contains("left"))return;const a=n("ul","message-menu"),o=n("li","message-menu_edit","edit",a),r=n("li","message-menu_delete","delete",a);a.style.top=`${e.clientY-i.offsetTop+i.scrollTop}px`,a.style.left=e.clientX-i.offsetLeft+"px",r.onclick=()=>{t(s.id.slice(8)),a.remove()},o.onclick=()=>{console.log("no realize yet"),a.remove()},i.append(a)})(e,i)}addHandles(e){this.userList.userList.onclick=n=>this.chooseUserHandle.bind(this)(n,e.getMessageHistory.bind(e)),this.userChat.chatingForm.onsubmit=n=>this.sendMessageHandle.bind(this)(n,e.sendMessage.bind(e)),this.userChat.messagesField.onscroll=n=>{this.changeReadStatusHandle.bind(this)(n,e.readStatusChange.bind(e))},this.userChat.messagesField.onclick=n=>{this.chatClickHandle.bind(this)(n,e.readStatusChange.bind(e),e.deleteMessage.bind(e))}}render(e){const n=this.makeWrap();return n.append(this.headerBlock.render(this.user,e.userOperation.bind(e)),this.makeChatBlock(),this.footerBlock.render()),this.addHandles(e),n}}class u{constructor(){this.mainPage=new p,this.websocket=new e,this.loginPage=new o(this.websocket.userOperation.bind(this.websocket))}autoAuthentic(e,n){this.mainPage.user={login:e,password:n,isLogined:!0},this.websocket.connection.onopen=()=>{this.websocket.userOperation("USER_LOGIN",e,n),this.pageResolver(document.location.pathname)}}pageResolver(e){const n=document.getElementById("app"),t=e.split("/").at(-1);switch(null==n||n.replaceChildren(),t){case"login":this.loginPage.render(n);break;case"main":this.websocket.getAllUsers(),null==n||n.append(this.mainPage.render(this.websocket));break;case"info":n.innerText="On info page"}}serverListener(){this.websocket.connection.onmessage=e=>{var n;const t=JSON.parse(e.data);switch(t.type){case"USER_LOGIN":{const[e,n]=i();this.mainPage.user={login:e,password:n,isLogined:!0},document.location.pathname.includes("/main")||(window.history.pushState({},"Chat","main"),this.pageResolver(document.location.pathname));break}case"ERROR":{const e=t.payload;this.loginPage.makeErrorModal(e.error),s();break}case"USER_ACTIVE":case"USER_INACTIVE":{const{users:e}=t.payload;this.mainPage.userList.addUsers(this.mainPage.user.login,e,this.websocket.getMessageHistory.bind(this.websocket));break}case"USER_EXTERNAL_LOGIN":case"USER_EXTERNAL_LOGOUT":{const e=t.payload;this.mainPage.userList.changeStatus(e.user.login,e.user.isLogined);break}case"USER_LOGOUT":window.history.replaceState({},"Login","login"),this.pageResolver(document.location.pathname);break;case"MSG_FROM_USER":{const e=t.payload;this.mainPage.userChat.container.dataset.name?this.mainPage.userChat.addOldMessages(e.messages):this.mainPage.userList.showUnreadMessageCount(this.mainPage.user.login,e.messages);break}case"MSG_SEND":{const e=t.payload,i=this.mainPage.userChat.messagesField,s=this.mainPage.userChat.container.dataset.name;s?s!==e.message.from&&this.mainPage.user.login!==e.message.from||("main-chat_field-startMessage"===(null===(n=i.children.item(0))||void 0===n?void 0:n.className)&&i.replaceChildren(),this.mainPage.userChat.addNewMessage(e.message,this.mainPage.userChat.container.dataset.name)):this.mainPage.userList.showUnreadMessageCount(this.mainPage.user.login,[e.message]);break}case"MSG_DELIVER":case"MSG_READ":(e=>{var n;const t=document.getElementById(`message-${e.id}`);if(null==t?void 0:t.classList.contains("right")){const i=null===(n=null==t?void 0:t.lastElementChild)||void 0===n?void 0:n.lastElementChild,s=Object.keys(e.status).at(0);i.innerText=`${s.slice(2)}`.toLowerCase()}})(t.payload.message);break;case"MSG_DELETE":(e=>{const n=document.getElementById(e);null==n||n.remove()})(`message-${t.payload.message.id}`)}}}serverDisconnectListener(){this.websocket.closeListener(this.loginPage.makeErrorModal.bind(this.loginPage))}initPage(){const e=i();if(e||(window.history.pushState({},"Login","login"),this.pageResolver(document.location.pathname)),e){const[n,t]=e;this.autoAuthentic(n,t)}this.serverListener(),this.serverDisconnectListener(),window.onpopstate=e=>{this.pageResolver(document.location.pathname),console.log(`location: ${document.location.href}, state: ${JSON.stringify(e.state)}`)}}}var m=t(72),g=t.n(m),f=t(825),b=t.n(f),v=t(659),x=t.n(v),y=t(56),w=t.n(y),_=t(540),k=t.n(_),L=t(113),S=t.n(L),E=t(11),C={};C.styleTagTransform=S(),C.setAttributes=w(),C.insert=x().bind(null,"head"),C.domAPI=b(),C.insertStyleElement=k(),g()(E.A,C),E.A&&E.A.locals&&E.A.locals,(new class{constructor(){this.container=n("div","container",void 0,document.body),this.container.id="app",this.route=new u}render(){this.route.initPage(),console.log("Hello world")}}).render()})()})();