(()=>{"use strict";var n={11:(n,e,t)=>{t.d(e,{A:()=>d});var o=t(601),i=t.n(o),r=t(314),s=t.n(r),a=t(768),l=t(699),c=s()(i());c.push([n.id,"@import url(https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600&display=swap);"]),c.i(a.A),c.i(l.A),c.push([n.id,'html{line-height:1.15;-webkit-text-size-adjust:100%}html body{margin:0;box-sizing:border-box;font-family:"Poppins",sans-serif}html *{margin:0;box-sizing:border-box}html a{background-color:rgba(0,0,0,0)}html button,html input,html optgroup,html select,html textarea{font-family:inherit;font-size:100%;line-height:1.15;margin:0}.container{margin:0 auto;max-width:1440px;min-height:100vh;max-height:max-content;display:flex;flex-direction:column;justify-content:center;align-items:center;background:#282727}',""]);const d=c},768:(n,e,t)=>{t.d(e,{A:()=>a});var o=t(601),i=t.n(o),r=t(314),s=t.n(r)()(i());s.push([n.id,".login__form {\n    margin-inline: 20px;\n    padding: 40px 16px;\n    max-width: 360px;\n    background: hsla(0, 0%, 100%, 0.2);\n    border: 2px solid hsla(0, 0%, 100%, 0.7);\n    color: hsl(0, 0%, 100%);\n    border-radius: 16px;\n    backdrop-filter: blur(16px);\n\n    .login__title {\n        margin: 20px 0;\n        text-align: center;\n        font-size: 40px;\n    }\n}\n\n.login__body {\n    display: grid;\n    row-gap: 20px;\n    margin-bottom: 16px;\n\n    .login__body_wrap {\n        display: grid;\n        padding-inline: 20px;\n        grid-template-columns: 1fr max-content;\n        column-gap: 12px;\n        align-items: center;\n        border: 2px solid hsla(0, 0%, 100%, 0.7);\n        border-radius: 64px;\n    }\n\n    .login__body_input {\n        outline: none;\n        width: 100%;\n        background: none;\n        border: none;\n        color: hsl(0, 0%, 100%);\n        padding-block: 16px;\n\n        &::placeholder {\n            color: hsl(0, 0%, 100%);\n        }\n    }\n}\n\n.login__button {\n    width: 100%;\n    padding: 16px;\n    margin-bottom: 16px;\n    background-color: hsl(0, 0%, 100%);\n    border-radius: 64px;\n    color: hsl(0, 0%, 0%);\n    font-weight: 500;\n    cursor: pointer;\n    border: none;\n    outline: none;\n}",""]);const a=s},699:(n,e,t)=>{t.d(e,{A:()=>a});var o=t(601),i=t.n(o),r=t(314),s=t.n(r)()(i());s.push([n.id,".main-wrap {\n    width: 1200px;\n    height: 560px;\n    display: flex;\n    flex-direction: column;\n    border-radius: 5px;\n    box-shadow: 0 0 10px 0 #444242;\n    color: hsl(0, 0%, 100%);\n\n    .main-header,\n    .main-footer {\n        padding: 0 16px;\n        height: 55px;\n        display: flex;\n        justify-content: space-between;\n        align-items: center;\n    }\n    .main-header {\n        width: 100%;\n\n        .main-header_user {\n            font-size: 24px;\n        }\n        .main-header_control {\n            display: flex;\n            gap: 25px;\n            font-size: 16px;\n\n            h1 {\n                margin-right: 50px;\n                font-size: 25px;\n            }\n            button {\n                border-radius: 6px;\n                border: none;\n                background: hsl(0, 0%, 100%);\n                cursor: pointer;\n\n                &:active {\n                    background: linear-gradient(hsl(0, 0%, 100%), #282727);\n                }\n            }\n        }\n    }\n    .main-chat {\n        display: flex;\n        flex-grow: 1;\n        border-top: solid 1px #5C5F6F;\n        border-bottom: solid 1px #5C5F6F;\n\n        &_list-wrap {\n            list-style: none;\n        }\n    }\n\n    .main-chat_list-wrap {\n        width: 25%;\n        border-right: solid 1px #5C5F6F;\n    }\n    .main-chat_find-wrap {\n        margin: 6px 7px 30px;\n        padding-inline: 20px;\n        width: 95%;\n        border: 2px solid hsla(0, 0%, 100%, 0.2);\n        border-radius: 6px;\n    }\n    .main-chat_find-Input {\n        outline: none;\n        width: 100%;\n        background: none;\n        border: none;\n        color: hsl(0, 0%, 100%);\n        padding-block: 10px;\n    }\n    .main-chat_list {\n        padding: 0;\n        list-style: none;\n    }\n    .main-chat_list-item {\n        padding: 12px 16px;\n        border-bottom: solid 1px #5C5F6F;\n        cursor: pointer;\n\n        &.offline {\n            color: hsl(0, 2%, 64%);\n        }\n    }\n}\n",""]);const a=s},314:n=>{n.exports=function(n){var e=[];return e.toString=function(){return this.map((function(e){var t="",o=void 0!==e[5];return e[4]&&(t+="@supports (".concat(e[4],") {")),e[2]&&(t+="@media ".concat(e[2]," {")),o&&(t+="@layer".concat(e[5].length>0?" ".concat(e[5]):""," {")),t+=n(e),o&&(t+="}"),e[2]&&(t+="}"),e[4]&&(t+="}"),t})).join("")},e.i=function(n,t,o,i,r){"string"==typeof n&&(n=[[null,n,void 0]]);var s={};if(o)for(var a=0;a<this.length;a++){var l=this[a][0];null!=l&&(s[l]=!0)}for(var c=0;c<n.length;c++){var d=[].concat(n[c]);o&&s[d[0]]||(void 0!==r&&(void 0===d[5]||(d[1]="@layer".concat(d[5].length>0?" ".concat(d[5]):""," {").concat(d[1],"}")),d[5]=r),t&&(d[2]?(d[1]="@media ".concat(d[2]," {").concat(d[1],"}"),d[2]=t):d[2]=t),i&&(d[4]?(d[1]="@supports (".concat(d[4],") {").concat(d[1],"}"),d[4]=i):d[4]="".concat(i)),e.push(d))}},e}},601:n=>{n.exports=function(n){return n[1]}},72:n=>{var e=[];function t(n){for(var t=-1,o=0;o<e.length;o++)if(e[o].identifier===n){t=o;break}return t}function o(n,o){for(var r={},s=[],a=0;a<n.length;a++){var l=n[a],c=o.base?l[0]+o.base:l[0],d=r[c]||0,p="".concat(c," ").concat(d);r[c]=d+1;var u=t(p),h={css:l[1],media:l[2],sourceMap:l[3],supports:l[4],layer:l[5]};if(-1!==u)e[u].references++,e[u].updater(h);else{var m=i(h,o);o.byIndex=a,e.splice(a,0,{identifier:p,updater:m,references:1})}s.push(p)}return s}function i(n,e){var t=e.domAPI(e);return t.update(n),function(e){if(e){if(e.css===n.css&&e.media===n.media&&e.sourceMap===n.sourceMap&&e.supports===n.supports&&e.layer===n.layer)return;t.update(n=e)}else t.remove()}}n.exports=function(n,i){var r=o(n=n||[],i=i||{});return function(n){n=n||[];for(var s=0;s<r.length;s++){var a=t(r[s]);e[a].references--}for(var l=o(n,i),c=0;c<r.length;c++){var d=t(r[c]);0===e[d].references&&(e[d].updater(),e.splice(d,1))}r=l}}},659:n=>{var e={};n.exports=function(n,t){var o=function(n){if(void 0===e[n]){var t=document.querySelector(n);if(window.HTMLIFrameElement&&t instanceof window.HTMLIFrameElement)try{t=t.contentDocument.head}catch(n){t=null}e[n]=t}return e[n]}(n);if(!o)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");o.appendChild(t)}},540:n=>{n.exports=function(n){var e=document.createElement("style");return n.setAttributes(e,n.attributes),n.insert(e,n.options),e}},56:(n,e,t)=>{n.exports=function(n){var e=t.nc;e&&n.setAttribute("nonce",e)}},825:n=>{n.exports=function(n){if("undefined"==typeof document)return{update:function(){},remove:function(){}};var e=n.insertStyleElement(n);return{update:function(t){!function(n,e,t){var o="";t.supports&&(o+="@supports (".concat(t.supports,") {")),t.media&&(o+="@media ".concat(t.media," {"));var i=void 0!==t.layer;i&&(o+="@layer".concat(t.layer.length>0?" ".concat(t.layer):""," {")),o+=t.css,i&&(o+="}"),t.media&&(o+="}"),t.supports&&(o+="}");var r=t.sourceMap;r&&"undefined"!=typeof btoa&&(o+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(r))))," */")),e.styleTagTransform(o,n,e.options)}(e,n,t)},remove:function(){!function(n){if(null===n.parentNode)return!1;n.parentNode.removeChild(n)}(e)}}}},113:n=>{n.exports=function(n,e){if(e.styleSheet)e.styleSheet.cssText=n;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(n))}}}},e={};function t(o){var i=e[o];if(void 0!==i)return i.exports;var r=e[o]={id:o,exports:{}};return n[o](r,r.exports,t),r.exports}t.n=n=>{var e=n&&n.__esModule?()=>n.default:()=>n;return t.d(e,{a:e}),e},t.d=(n,e)=>{for(var o in e)t.o(e,o)&&!t.o(n,o)&&Object.defineProperty(n,o,{enumerable:!0,get:e[o]})},t.o=(n,e)=>Object.prototype.hasOwnProperty.call(n,e),t.nc=void 0,(()=>{class n{constructor(n="ws://127.0.0.1:4000"){this.connection=new WebSocket(n)}userOperation(n,e,t){const o={id:n.includes("IN")?`login_${e}`:`logout_${e}`,type:n,payload:{user:{login:e,password:t}}},i=JSON.stringify(o);this.connection.send(i)}getAllUsers(){const n="USER_ACTIVE",e="USER_INACTIVE";this.connection.send(JSON.stringify({id:`get${n.slice(4)}`,type:n,payload:null})),this.connection.send(JSON.stringify({id:`get${e.slice(4)}`,type:e,payload:null}))}}const e=(n,e,t=void 0,o=void 0,i=void 0)=>{const r=document.createElement(`${n}`);return r.classList.add(`${e}`),t&&(r.innerText=t),i&&i.forEach((n=>{Object.keys(n).forEach((e=>{r.setAttribute(e,n[e])}))})),o&&o.append(r),r},o=()=>{const n=sessionStorage.getItem("user");if(n){const e=JSON.parse(n),{login:t,password:o}=e,i=(n=>{let e="";const t=n.slice(3);for(let n=0;n<t.length;n+=3)e+=t[n+2];return e})(o);return[t,i]}return n};class i{constructor(n,e=1){this.valueInputs=n,this.amountBtn=e}buildForm(n){const t=e("form","login__form",void 0,void 0,[{action:""}]);return e("h2","login__title","Login",t),t.addEventListener("submit",(e=>{e.preventDefault();const[i,r]=t.querySelectorAll("input"),s=o();if(s){const[e,t]=s;n("USER_LOGIN",e,t)}s||((n=>{const e=(n=>{let e="abc";for(let t=0;t<n.length;t+=1)e+=`${"abcdefghijklmnopqrstuvwxyz"[t%26]}${t%2?4:2}${n[t]}`;return e})(n.password),t={login:n.login,password:e,isLogined:n.isLogined};sessionStorage.setItem("user",JSON.stringify(t))})({login:i.value,password:r.value,isLogined:!0}),n("USER_LOGIN",i.value,r.value))})),t}buildInputs(){const n=e("div","login__body"),t=document.createDocumentFragment();return this.valueInputs.forEach(((n,o)=>{const i=e("div","login__body_wrap");e("input","login__body_input",void 0,i,[{type:n},{placeholder:0===o?"First Name":"Password"},{pattern:""+(0===o?"^[A-ZА-Я][a-zа-я\\-]{2,}":"^[A-Za-z0-9]{3,}")},{title:0===o?"The first letter must be capitalized. Min length: 3":"Min length: 4"},{required:""}]),t.append(i)})),n.appendChild(t),n}buildButton(){const n=document.createDocumentFragment();for(let t=1;t<=this.amountBtn;t+=1)if(1===t){const t=e("button","login__button","Login",void 0,[{type:"submit"}]);n.appendChild(t)}else{const t=e("button","login__button","Info",void 0);n.appendChild(t)}return n}render(n){const e=this.buildForm(n),t=this.buildInputs(),o=this.buildButton();return e.append(t),e.append(o),e}}class r{constructor(n){this.loginForm=new i(["text","password"],2),this.LoginRequest=n}render(n){n.append(this.loginForm.render(this.LoginRequest))}}class s{constructor(){this.container=e("div","main-chat_field")}render(){return this.container}}class a{constructor(){this.listContainer=e("div","main-chat_list-wrap")}addUsers(n,t){const o=this.listContainer.querySelector(".main-chat_list");t.length&&t.forEach(((t,i)=>{if(n!==t.login&&(!(null==o?void 0:o.children[i])||(null==o?void 0:o.children[i].innerHTML)!==t.login)){const n=t.isLogined?"online":"offline",i=e("li","main-chat_list-item",`${t.login}`,void 0,[{name:`${t.login}`}]);i.classList.add(n),null==o||o.append(i)}}))}changeStatus(n,e){const t=this.listContainer.children[1],o=t.children.namedItem(n);e?(null==o||o.classList.remove("offline"),null==o||o.classList.add("online"),o&&(t.prepend(o.cloneNode(!0)),null==o||o.remove())):(null==o||o.classList.remove("online"),null==o||o.classList.add("offline"))}inputAdd(){const n=e("div","main-chat_find-wrap");return e("input","main-chat_find-Input",void 0,n,[{type:"text"},{placeholder:"Search.."}]),n}render(){const n=e("ul","main-chat_list");return this.listContainer.children.length<1&&this.listContainer.append(this.inputAdd(),n),this.listContainer}}class l{constructor(){this.userList=new a,this.userChat=new s,this.user={login:"",password:"",isLogined:!1}}makeWrap(){return e("div","main-wrap")}makeHeaderElems(n,t){const o=document.createDocumentFragment(),i=e("div","main-header_user",`User: ${n}`),r=e("div","main-header_control"),s=e("button","main-header_logout","LogOut");return s.onclick=()=>{sessionStorage.removeItem("user"),t("USER_LOGOUT",this.user.login,this.user.password)},r.append(e("h1","main-header_title","Fun chat"),e("button","main-header_info","Info"),s),o.append(i,r),o}makeChatBlock(){const n=e("div","main-chat");return n.append(this.userList.render(),this.userChat.render()),n}makeFooterElems(){const n=document.createDocumentFragment(),t=e("a","gh-link","My Github",void 0,[{href:"https://github.com/AleksPaty"}]),o=e("p","about","Thank you for your attention. 2024 ©"),i=e("p","re-school","RSSchool");return n.append(t,o,i),n}render(n,t){const o=e("div","main-header"),i=e("div","main-footer"),r=this.makeWrap();return o.append(this.makeHeaderElems(n,t)),i.append(this.makeFooterElems()),r.append(o,this.makeChatBlock(),i),r}}class c{constructor(){this.mainPage=new l,this.websocket=new n,this.loginPage=new r(this.websocket.userOperation.bind(this.websocket))}autoAuthentic(n,e){this.mainPage.user={login:n,password:e,isLogined:!0},this.websocket.connection.onopen=()=>{this.websocket.userOperation("USER_LOGIN",n,e),this.pageResolver(document.location.pathname,n)}}pageResolver(n,e){const t=document.getElementById("app");switch(null==t||t.replaceChildren(),n){case"/login":this.loginPage.render(t);break;case"/main":this.websocket.getAllUsers(),null==t||t.append(this.mainPage.render(e,this.websocket.userOperation.bind(this.websocket)));break;case"/info":t.innerText="On info page"}}serverListener(){this.websocket.connection.onmessage=n=>{const e=JSON.parse(n.data);switch(console.log(e),e.type){case"USER_LOGIN":{const[n,e]=o();this.mainPage.user={login:n,password:e,isLogined:!0},"/main"!==document.location.pathname&&(window.history.pushState({},"Chat","main"),this.websocket.getAllUsers(),this.pageResolver("/main",this.mainPage.user.login));break}case"USER_ACTIVE":case"USER_INACTIVE":{const{users:n}=e.payload;this.mainPage.userList.addUsers(this.mainPage.user.login,n);break}case"USER_EXTERNAL_LOGIN":case"USER_EXTERNAL_LOGOUT":{const n=e.payload;this.mainPage.userList.changeStatus(n.user.login,n.user.isLogined);break}case"USER_LOGOUT":window.history.replaceState({},"Login","login"),this.pageResolver("/login")}}}initPage(){const n=o();if(n||(window.history.pushState({},"Login","login"),this.pageResolver(document.location.pathname)),n){const[e,t]=n;this.autoAuthentic(e,t)}this.serverListener(),window.onpopstate=n=>{console.log("onpopstate"),this.pageResolver(document.location.pathname,this.mainPage.user.login),console.log(`location: ${document.location.href}, state: ${JSON.stringify(n.state)}`)}}}var d=t(72),p=t.n(d),u=t(825),h=t.n(u),m=t(659),g=t.n(m),f=t(56),b=t.n(f),v=t(540),x=t.n(v),y=t(113),w=t.n(y),_=t(11),k={};k.styleTagTransform=w(),k.setAttributes=b(),k.insert=g().bind(null,"head"),k.domAPI=h(),k.insertStyleElement=x(),p()(_.A,k),_.A&&_.A.locals&&_.A.locals,(new class{constructor(){this.container=e("div","container",void 0,document.body),this.container.id="app",this.route=new c}render(){this.route.initPage(),console.log("Hello world")}}).render()})()})();